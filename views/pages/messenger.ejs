<link rel="stylesheet" href="/customCss/messenger.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark" id="userNavBar">
  <div class="container-fluid">
    <a class="navbar-brand" href="/"><img src="http://localhost:1337/images/komvos/KOMVOS7.png" alt="Komvos logo" width="45em" height="28em"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
      aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/">Αρχική</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/#features">Ποιοι είμαστε</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button"
            data-bs-toggle="dropdown" aria-expanded="false">
            Κοινότητα
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <li><a class="dropdown-item" href="/listings-offered">Αγγελίες Προσφοράς</a></li>
            <li><a class="dropdown-item" href="/listings-received">Αγγελίες Ζήτησης</a></li>
            <li><a class="dropdown-item" href="/events">Δράσεις</a></li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="dropdown profileDropdown">
      <button class=" btn-light dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown"aria-expanded="false">
        <img class="profile-image" src="http://localhost:1337/<%= photo %>" alt="Profile img">
      </button>
      <ul class="dropdown-menu " aria-labelledby="dropdownMenuButton1">
        <li><a class="dropdown-item" href="/userprofile" >Προφίλ </a></li>
        <% if(isAdmin) { %>
          <li><a class="dropdown-item" href="/admin">Σελίδα Διαχειριστή </a></li>
          <% } %>
        <li><a class="dropdown-item" href="/donation">Δωρεά</a></li>
        <li><a class="dropdown-item" href="/logout">Αποσύνδεση</a></li>
      </ul>
    </div>

  </div>
</nav>


<main>
  <div class="container-fluid px-4 mt-4">
    <div class="row">
      <div class="col-4 leftSide">
        <div class="settings-tray">
          <a href="/userprofile">
            <!-- my photo -->
            <img class="profile-image" src="http://localhost:1337/<%= photo %>" alt="Profile img">
          </a>
          <!-- user name in chat  -->
          <div id="username">
            <%= userFullName %>
          </div>
        </div>
        <!-- <div class="search-box">
          <div class="input-wrapper">
            <i class="material-icons">search</i>
            <input placeholder="Search here" type="text">
          </div>
        </div> -->
        <div id="chats">
          <% for (let chat of chats) { %>
            <div class="conversations" id="<%=chat.userId%>"
              onclick="openChat('<%=chat.userId%>')">
              <div class="friend-drawer friend-drawer--onhover">
                <!-- other persons photo -->
                <img class="profile-image" src="http://localhost:1337/<%=chat.photo%>" alt="">
                <div class="text">
                  <h6>
                    <%=chat.firstName%>
                      <%=chat.lastName%>
                  </h6>
                  <p class="text-muted">
                    <%= chat.text %>
                  </p>
                </div>
                <span class="time text-muted small">
                  <%= new Date(chat.createdAt).toLocaleString([], {year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit' , minute:'2-digit', hour12: false}) %>
                </span>
              </div>
              <hr>
            </div>
            <% } %>
        </div>
      </div>
      <div class="col-8 rightSide" id="rightSide" style="display: none;">
        <div id="userName"></div>
        <hr>
        <div id="messages"></div>
        <hr>
        <div class="messange-box">
          <input type="text" id="userMessage" placeholder="Type your message here...">
          <button class="material-icons" id="sendBtn" onclick="sendMessage()">send</button>
        </div>
      </div>
    </div>
  </div>
</main>
<script>
  let activeChatUser = '<%= activeChatUser %>';
  let activeChatUserPhoto = '<%= activeChatUserPhoto %>'
 
</script>
<script src="/customJs/messenger.js"></script>